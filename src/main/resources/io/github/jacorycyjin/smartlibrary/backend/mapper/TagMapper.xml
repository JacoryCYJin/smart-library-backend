<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="io.github.jacorycyjin.smartlibrary.backend.mapper.TagMapper">

    <!-- 批量查询资源的标签信息 -->
    <select id="selectTagsByResourceIds" resultType="map">
        SELECT 
            rtr.resource_id AS resourceId,
            t.tag_id AS tagId,
            t.name AS tagName,
            t.type AS tagType,
            rtr.weight AS weight
        FROM resource_tag_rel rtr
        INNER JOIN tag t ON rtr.tag_id = t.tag_id
        WHERE rtr.resource_id IN
        <foreach collection="resourceIds" item="id" open="(" separator="," close=")">
            #{id}
        </foreach>
        ORDER BY rtr.resource_id, rtr.weight DESC, rtr.id
    </select>

    <!-- 查询所有标签 -->
    <select id="selectAll" resultType="map">
        SELECT 
            tag_id AS tagId,
            name,
            type,
            ctime,
            mtime
        FROM tag
        WHERE deleted = 0
        ORDER BY name
    </select>
</mapper>
